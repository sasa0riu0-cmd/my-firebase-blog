
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>私のブログ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        h1 {
            color: #333;
        }
        .post-form {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .posts {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
        }
        .post {
            border-bottom: 1px solid #ddd;
            padding: 15px 0;
        }
        .post:last-child {
            border-bottom: none;
        }
        .post h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .post p {
            margin: 0;
            color: #666;
        }
        .post .date {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>私のブログ</h1>
    
    <div class="post-form">
        <h2>新しい投稿</h2>
        <input type="text" id="title" placeholder="タイトルを入力">
        <textarea id="content" rows="5" placeholder="本文を入力"></textarea>
        <button onclick="addPost()">投稿する</button>
    </div>
    
    <div class="posts">
        <h2>投稿一覧</h2>
        <div id="postsList"></div>
    </div>

    <!-- Firebase SDKを読み込む -->
    <script type="module">
        // Firebaseをインポート
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, orderBy, query } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // ここに、STEP 3でコピーした設定情報を貼り付ける
        const firebaseConfig = {
            <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyA3yb-K92duU0lPsY8sm2zy8kFYs4W51ZU",
    authDomain: "my-blog-project-763d9.firebaseapp.com",
    projectId: "my-blog-project-763d9",
    storageBucket: "my-blog-project-763d9.firebasestorage.app",
    messagingSenderId: "376707551597",
    appId: "1:376707551597:web:c95249949e7527e1b64a64"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
</script>

        };

        // Firebaseを初期化
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 投稿を追加する関数
        window.addPost = async function() {
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            
            if (title && content) {
                try {
                    await addDoc(collection(db, 'posts'), {
                        title: title,
                        content: content,
                        timestamp: new Date()
                    });
                    
                    // 入力欄をクリア
                    document.getElementById('title').value = '';
                    document.getElementById('content').value = '';
                    
                    // 投稿一覧を再読み込み
                    loadPosts();
                } catch (error) {
                    console.error('投稿に失敗しました:', error);
                    alert('投稿に失敗しました');
                }
            } else {
                alert('タイトルと本文を入力してください');
            }
        };

        // 投稿一覧を読み込む関数
        async function loadPosts() {
            const postsList = document.getElementById('postsList');
            postsList.innerHTML = '<p>読み込み中...</p>';
            
            try {
                const q = query(collection(db, 'posts'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    postsList.innerHTML = '<p>まだ投稿がありません</p>';
                    return;
                }
                
                postsList.innerHTML = '';
                querySnapshot.forEach((doc) => {
                    const post = doc.data();
                    const postDiv = document.createElement('div');
                    postDiv.className = 'post';
                    postDiv.innerHTML = `
                        <h3>${post.title}</h3>
                        <p>${post.content}</p>
                        <div class="date">${new Date(post.timestamp.toDate()).toLocaleString('ja-JP')}</div>
                    `;
                    postsList.appendChild(postDiv);
                });
            } catch (error) {
                console.error('投稿の読み込みに失敗しました:', error);
                postsList.innerHTML = '<p>投稿の読み込みに失敗しました</p>';
            }
        }

        // ページ読み込み時に投稿一覧を表示
        loadPosts();
    </script>
</body>
</html>
